// ============================================================================
// Map: v1rocket
// Last update : 01/12/04 FireFly
// ============================================================================
game_manager
{
	spawn
	{
		create
		{
			scriptName "allied_cp_spawn_obj"
			classname "team_WOLF_objective"
			targetname "allied_cp_spawn_obj"
			origin "811 1210 360 "	// z = CC_FILTER_ALLIES(2) | CC_FILTER_SPAWNS(4)
			spawnflags 2	// TEAM_ALLIES
			description "Allied Spawn 2"
		}

		create
		{
			scriptName "alliedhq_spawn1"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "905 1327 360"
			angle 177
			spawnflags 2	// TEAM_ALLIES
		}

		create
		{
			scriptName "alliedhq_spawn7"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "807 1333 360"
			angle 177
			spawnflags 2	// TEAM_ALLIES
		}

		create
		{
			scriptName "alliedhq_spawn4"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "697 1337 360"
			angle 179
			spawnflags 2	// TEAM_ALLIES
		}

		create
		{
			scriptName "alliedhq_spawn8"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "727 1213 360"
			angle 147
			spawnflags 2	// TEAM_ALLIES
		}

		create
		{
			scriptName "alliedhq_spawn2"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "811 1210 360"
			angle 180
			spawnflags 2	// TEAM_ALLIES
		}

		create
		{
			scriptName "alliedhq_spawn5"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "919 1204 360"
			angle 179
			spawnflags 2	// TEAM_ALLIES
		}

		create
		{
			scriptName "alliedhq_spawn3"
			classname "team_CTF_bluespawn"
			targetname "alliedhq_spawn"
			origin "910 1078 360"
			angle 177
			spawnflags 2	// TEAM_ALLIES
		}

		
		accum 6 set 1
		// Game rules
		wm_axis_respawntime	25
		wm_allied_respawntime	15
		wm_number_of_objectives 7
		wm_set_round_timelimit	30

		// the Objectives
		// 1: construct the bridge
		// 2: blow main entrance
		// 3: escort the lorraine to the depotyard
		// 4: Steal the fuel
		// 5: capture depotyard flag
		// 6: allied command post
		// 7: axis command post

		// Current main objectives for each team (0=Axis, 1=Allies)
		wm_set_main_objective		1	0
		wm_set_main_objective		1	1

		// Objective overview status indicators
		//wm_objective_status <objective> <team (0=Axis, 1=Allies)> <status (0=neutral 1=complete 2=failed)>
		wm_objective_status 1 1 0
		wm_objective_status 1 0 0
		wm_objective_status 2 1 0
		wm_objective_status 2 0 0
		wm_objective_status 3 1 0
		wm_objective_status 3 0 0
		wm_objective_status 4 1 0
		wm_objective_status 4 0 0
		wm_objective_status 5 1 0
		wm_objective_status 5 0 0
		wm_objective_status 6 1 0
		wm_objective_status 6 0 0
		wm_objective_status 7 1 0
		wm_objective_status 7 0 0

		// Stopwatch mode defending team (0=Axis, 1=Allies)
		wm_set_defending_team	0

		// Winner on expiration of round timer (0=Axis, 1=Allies)
		wm_setwinner	0

		// Accumulator to check win conditions
		accum 1 set 0

		// Setup the auto spawn points for the map
		wait 500
		setstate allied_cp_spawn_obj invisible
		setstate alliedhq_spawn invisible
		setautospawn "Allied Spawn 2" 1
		//setautospawn "Allied Entrance Spawn" 1
		setautospawn "Main Entrance" 0
		setstate capturespawn invisible //depotyardflag

		// INVISIBLE STUFF
		setstate thev1rocket invisible		// v1 rocket model
		setstate rocket_endpoint invisible	//fuel drop point
		setstate v1rocket_toi invisible		// trigg_obj_info v1rocket
		setstate v1rocket_cm_marker invisible	//cm_marker v1rocket
		setstate tank_static invisible		//dummy lorraine (Tank)
		setstate debris1 invisible 		//flying debris at maindoor
		setstate debris2 invisible 		//flying debris at maindoor
		
		// CP speakers
		disablespeaker allies_radio
		disablespeaker axis_radio

		wait 2000

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "fueldump_axis_bridge_stop"
		wm_addteamvoiceannounce 1 "v1rocket_allies_escort_depotyard"
		wait 750
		wm_addteamvoiceannounce 0 "axis_hq_compost_construct"
		wm_addteamvoiceannounce 1 "fueldump_allies_bridge_construct"
		
		
		wm_teamvoiceannounce 0 "fueldump_axis_bridge_stop"
		wm_teamvoiceannounce 1 "v1rocket_allies_escort_depotyard"
		wait 750
		wm_teamvoiceannounce 0 "axis_hq_compost_construct"
		wm_teamvoiceannounce 1 "fueldump_allies_bridge_construct"
		// *---------------------------------------------------------------------------------*
	}

	trigger stolen_rocketfuel
	{
		accum 1 inc 1				// rocketfuel stolen
		trigger game_manager checkgame		// Check for end of game
	}

	trigger maindoor1_destroyed
	{
		
		alertentity maindoor_explo
		alertentity maindoor_rubble1
		trigger debris1 flying
		trigger debris2 flying
	
		wm_objective_status 2 1 1
		wm_objective_status 2 0 2

		wm_set_main_objective		3	0
		wm_set_main_objective		3	1

		alertentity mainentrance_wobj
		setautospawn "Allied Entrance Spawn" 0
		setautospawn "Main Entrance" 1
		alertentity t108	// Switch the tunnel spawns around
		
		wm_announce	"Allies have breached the Main Entrance and entered the Rocket Base"

		wait 1000

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "radar_axis_entrance1_destroyed"
		
		wm_teamvoiceannounce 1 "radar_allies_entrance1_destroyed"
		wm_teamvoiceannounce 1 "v1rocket_allies_escort_depotyard"

		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_destroy"
		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_stop"
		wm_removeteamvoiceannounce 0 "radar_axis_entrance1_stop"

		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_construct"
		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_reinforce"
		wm_removeteamvoiceannounce 1 "fueldump_allies_tank_bridge"
		wm_removeteamvoiceannounce 1 "radar_allies_entrance1_destroy"
		// *---------------------------------------------------------------------------------*
	}

	trigger depotyard_flagblue
	{
		// Some kind of UI pop-up to alert players
		wm_announce	"Allies captured the Depot Yard!"

		wm_objective_status	5 1 1
		wm_objective_status	5 0 2
	}

	trigger depotyard_flagred
	{
		// Some kind of UI pop-up to alert players
		wm_announce	"Axis captured the Depot Yard!"

		wm_objective_status	5 1 2
		wm_objective_status	5 0 1
	}

	trigger tank_at_depotyard
	{
		setstate allied_cp_spawn_obj default
		setstate alliedhq_spawn default
		setautospawn "Allied Spawn 2" 1
		trigger depotflag force_allied
		// Some kind of UI pop-up to alert players
		wm_announce	"Allies have escorted the Lorraine to the DepotYard"

		wm_objective_status	3 1 1
		wm_objective_status	3 0 2

		wm_set_main_objective		4	0
		wm_set_main_objective		4	1
	}

	trigger checkgame
	{
		accum 1 abort_if_not_equal 1

		// Set the round winner:  0 == AXIS, 1 == ALLIED
		wm_setwinner 1

		// End the round
		wm_endround

		wait 500

		trigger thev1rocket launch
	}
}


rocket_endpoint // Exit point of map
{
	death
	{
		trigger game_manager stolen_rocketfuel
	}
}

fuelcan
{
	spawn
	{
	}

	trigger stolen
	{
		setstate rocketfuel_cm_marker invisible
		wait 1000

		


		// *----------------------------------- vo ------------------------------------------*
		//wm_teamvoiceannounce 0 "axis_stolen_fuel"
		//wm_teamvoiceannounce 1 "allies_stolen_fuel"
		// *---------------------------------------------------------------------------------*
	}

	trigger returned

		
		
	{
		// *----------------------------------- vo ------------------------------------------*
		//wm_teamvoiceannounce 0 "radar_axis_radarw_returned"
		//wm_teamvoiceannounce 1 "radar_allies_radarw_returned"
		// *---------------------------------------------------------------------------------*

		setstate rocketfuel_cm_marker default
		
	}

	
}

// ================================================
// =========== SPAWN POINT CONTROLS ===============
// ================================================
// description			: team_wolf_objectives		: spawns
// Allied Entrance Spawn 	: alliedstart_wobj		: alliedrearspawn
// Main Entrance 		: mainentrance_wobj		: t108
// Depot Yard			: capturespawn			: depotspawn
// Radar 1			: radar1_wobj			: axisrearspawn
// Radar 2			: radar2_wobj			: mainbunker_spawns

depotflag
{
	spawn
	{
		accum 6 set 0	// Who has the flag: 0-Axis, 1-Allied
	}

	trigger allied_capture
	{
		accum 6 abort_if_equal 1 // do Allies own flag?

		trigger game_manager depotyard_flagblue

		setstate depotspawn default
		setstate capturespawn_wobj default

		trigger depotflag setallies

		

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "railgun_axis_depot_lost"
		wm_teamvoiceannounce 1 "railgun_allies_depot_captured"
		// *---------------------------------------------------------------------------------*
	}

	trigger setallies
	{
		accum 6 abort_if_equal 1
		accum 6 set 1

		alertentity capturespawn_wobj
		alertentity depotspawn

		
	}

	trigger axis_capture
	{
		accum 6 abort_if_equal 0 // do Axis own flag?

		trigger game_manager depotyard_flagred

		setstate depotspawn default
		setstate capturespawn_wobj default

		trigger depotflag setaxis
		
		

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "railgun_axis_depot_captured"
		wm_teamvoiceannounce 1 "railgun_allies_depot_lost"
		// *---------------------------------------------------------------------------------*
	}

	trigger setaxis
	{
		accum 6 abort_if_equal 0
		accum 6 set 0

		alertentity capturespawn_wobj
		alertentity depotspawn
	}
	trigger force_allied
{
		accum 6 abort_if_equal 1 // do Allies own flag?

		trigger game_manager depotyard_flagblue

		setstate depotspawn default
		setstate capturespawn_wobj default

		trigger depotflag setallies

		
setstate depotflag invisible
		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "railgun_axis_depot_lost"
		wm_teamvoiceannounce 1 "railgun_allies_depot_captured"
		// *---------------------------------------------------------------------------------*
}
}
// ============== end spawn point controls ========
// ================================================

// ============================================================================
// Tank stuff starts here
// ============================================================================
tank_sound
{
	trigger start
	{
		trigger tank sound_start
		wait 3400
		trigger tank sound_move
	}

	trigger stop
	{
		trigger tank sound_stop
		wait 1400
		trigger tank sound_idle
	}

	trigger rebirth
	{
		trigger tank sound_rebirth
		wait 1400
		trigger tank sound_idle
	}
}

// digibob: converting truck script from goldrush over...
// ============================================================================
// accum 0, dynamite count
// accum 1
//  - bit 0: bridge state		( 0 = not built,	1 = built		)
//  - bit 1: blank
//  - bit 2: spline status 		( 0 = not moving, 	1 = moving 		)
//  - bit 3: stuck check flag 	( 0 = not stuck, 	1 = stuck 		)
//  - bit 4: blank 				(									)
//  - bit 5: track state		( 0 = stopped,		1 = forward		)
//  - bit 6: temp register 		(XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX)
//  - bit 7: death status 		( 0 = alive, 		1 = dead		)
//  - bit 8: player check 		( 0 = players, 		1 = no players	)
//  - bit 9: visible state		( 0 = alive, 		1 = dead		)
// accum 2, dyno door status      
// accum 3, current movement loop position
// accum 4, stop counter
// accum 5, lockout ref counter
// accum 6, blank
// accum 7, blank
// ===========================================================================================
// spline points are spln0 -> spln65 tunnel1 -> tunnel12 spln66 -> spln86 spln2_0 -> spln2_39
// ===========================================================================================
// track events:
//  - tracks_forward
//  - tracks_stop
//  - tracks_turningleft
//  - tracks_turningright

tank
{
	spawn
	{
		wait 50
		trigger self sound_idle

		accum 1 bitset 5
		trigger self tracks_stop
	}

	trigger sound_idle
	{
		stopsound
		playsound sound/vehicles/tank/tank_idle.wav looping volume 512
	}

	trigger sound_start
	{
		stopsound
		playsound sound/vehicles/tank/tank_revup.wav volume 196
	}

	trigger sound_move
	{
		stopsound
		playsound sound/vehicles/tank/tank_move.wav looping volume 512
	}

	trigger sound_stop
	{
		stopsound
		playsound sound/vehicles/tank/tank_revdown.wav volume 196
	}

	trigger sound_death
	{
		stopsound
		playsound sound/vehicles/tank/tank_stop.wav volume 256
	}

	trigger sound_rebirth
	{
		stopsound
		playsound sound/vehicles/tank/tank_start.wav volume 196
	}

// ===========================================================================================

	trigger tracks_forward
	{
		accum 1 abort_if_bitset 5
		accum 1 bitset 5
		
		remapshader models/mapobjects/v1/lorraine_tracks_left 	models/mapobjects/v1/lorraine_tracks_forward
		remapshader models/mapobjects/v1/lorraine_tracks_right  models/mapobjects/v1/lorraine_tracks_forward
		remapshader models/mapobjects/v1/ff_cog_right	        models/mapobjects/v1/ff_cog_right			
		remapshader models/mapobjects/v1/ff_cog_left		models/mapobjects/v1/ff_cog_left
		remapshader models/mapobjects/v1/wheelz_l		models/mapobjects/v1/wheelz_forward
		remapshader models/mapobjects/v1/wheelz_r		models/mapobjects/v1/wheelz_forward
		remapshaderflush
	}

	trigger tracks_stop
	{
		accum 1 abort_if_not_bitset 5
		accum 1 bitreset 5

		remapshader models/mapobjects/v1/lorraine_tracks_left 	models/mapobjects/v1/lorraine_tracks_left
		remapshader models/mapobjects/v1/lorraine_tracks_right  models/mapobjects/v1/lorraine_tracks_right
		remapshader models/mapobjects/v1/ff_cog_right		models/mapobjects/v1/ff_cog_stop			
		remapshader models/mapobjects/v1/ff_cog_left		models/mapobjects/v1/ff_cog_stop
		remapshader models/mapobjects/v1/wheelz_l		models/mapobjects/v1/wheelz_l
		remapshader models/mapobjects/v1/wheelz_r		models/mapobjects/v1/wheelz_r
		remapshaderflush
	}
//
//	trigger tracks_turn_left
//	{
//		accum 0 abort_if_equal 2
//		accum 0 set 2
//
//		remapshader models/mapobjects/v1/lorraine_left 	models/mapobjects/v1/lorraine__backward
//		remapshader models/mapobjects/v1/lorraine_right models/mapobjects/v1/lorraine_forward
//		
//	remapshaderflush
//	}
//
//	trigger tracks_turn_right
//	{
//		accum 0 abort_if_equal 3
//		accum 0 set 3
//
//		remapshader models/mapobjects/v1/lorraine_left 	models/mapobjects/v1/lorraine_forward
//		remapshader models/mapobjects/v1/lorraine_right models/mapobjects/v1/lorraine__backward
//		
//		remapshaderflush
//	}
// ===========================================================================================
// ===========================================================================================

	trigger run_incpos
	{
		accum 3 inc 1
	}

	trigger run_continue
	{
		trigger self run_incpos
		trigger self deathcheck
		trigger self stopcheck
		trigger self move
	}
// ===========================================================================================
// ===========================================================================================
// 
	trigger move_check
	{
		trigger self stuck_check
		accum 1 abort_if_bitset 3

		trigger self dispatch
	}

	trigger move
	{
		trigger self move_check

		wait 500

		trigger self move
	}

	trigger dispatch
	{
		accum 3 trigger_if_equal 0 tank run_0
		accum 3 trigger_if_equal 1 tank run_1
		accum 3 trigger_if_equal 2 tank run_2
		accum 3 trigger_if_equal 3 tank run_3
		accum 3 trigger_if_equal 4 tank run_4
		accum 3 trigger_if_equal 5 tank run_5
		accum 3 trigger_if_equal 6 tank run_6
		accum 3 trigger_if_equal 7 tank run_7
		accum 3 trigger_if_equal 8 tank run_8
		accum 3 trigger_if_equal 9 tank run_9
		accum 3 trigger_if_equal 10 tank run_10
		accum 3 trigger_if_equal 11 tank run_11
		accum 3 trigger_if_equal 12 tank run_12
		accum 3 trigger_if_equal 13 tank run_13
		accum 3 trigger_if_equal 14 tank run_14
		accum 3 trigger_if_equal 15 tank run_15
		accum 3 trigger_if_equal 16 tank run_16
		accum 3 trigger_if_equal 17 tank run_17
		accum 3 trigger_if_equal 18 tank run_18
		accum 3 trigger_if_equal 19 tank run_19
		accum 3 trigger_if_equal 20 tank run_20
		accum 3 trigger_if_equal 21 tank run_21
		accum 3 trigger_if_equal 22 tank run_22
		accum 3 trigger_if_equal 23 tank run_23
		accum 3 trigger_if_equal 24 tank run_24
		accum 3 trigger_if_equal 25 tank run_25
		accum 3 trigger_if_equal 26 tank run_26
		accum 3 trigger_if_equal 27 tank run_27
		accum 3 trigger_if_equal 28 tank run_28
		accum 3 trigger_if_equal 29 tank run_29
		accum 3 trigger_if_equal 30 tank run_30
		accum 3 trigger_if_equal 31 tank run_31
		accum 3 trigger_if_equal 32 tank run_32
		accum 3 trigger_if_equal 33 tank run_33
		accum 3 trigger_if_equal 34 tank run_34
		accum 3 trigger_if_equal 35 tank run_35
		accum 3 trigger_if_equal 36 tank run_36
		accum 3 trigger_if_equal 37 tank run_37
		accum 3 trigger_if_equal 38 tank run_38
		accum 3 trigger_if_equal 39 tank run_39
		accum 3 trigger_if_equal 40 tank run_40
		accum 3 trigger_if_equal 41 tank run_41
		accum 3 trigger_if_equal 42 tank run_42
		accum 3 trigger_if_equal 43 tank run_43
		accum 3 trigger_if_equal 44 tank run_44
		accum 3 trigger_if_equal 45 tank run_45
		accum 3 trigger_if_equal 46 tank run_46
		accum 3 trigger_if_equal 47 tank run_47
		accum 3 trigger_if_equal 48 tank run_48
		accum 3 trigger_if_equal 49 tank run_49
		accum 3 trigger_if_equal 50 tank run_50
		accum 3 trigger_if_equal 51 tank run_51
		accum 3 trigger_if_equal 52 tank run_52
		accum 3 trigger_if_equal 53 tank run_53
		accum 3 trigger_if_equal 54 tank run_54
		accum 3 trigger_if_equal 55 tank run_55
		accum 3 trigger_if_equal 56 tank run_56
		accum 3 trigger_if_equal 57 tank run_57
		accum 3 trigger_if_equal 58 tank run_58
		accum 3 trigger_if_equal 59 tank run_59
		accum 3 trigger_if_equal 60 tank run_60
		accum 3 trigger_if_equal 61 tank run_61
		accum 3 trigger_if_equal 62 tank run_62
		accum 3 trigger_if_equal 63 tank run_63
		accum 3 trigger_if_equal 64 tank run_64
		accum 3 trigger_if_equal 65 tank run_65
		accum 3 trigger_if_equal 66 tank run_66
		accum 3 trigger_if_equal 67 tank run_67
		accum 3 trigger_if_equal 68 tank run_68
		accum 3 trigger_if_equal 69 tank run_69
		accum 3 trigger_if_equal 70 tank run_70
		accum 3 trigger_if_equal 71 tank run_71
		accum 3 trigger_if_equal 72 tank run_72
		accum 3 trigger_if_equal 73 tank run_73
		
	}

// ===========================================================================================
// ===========================================================================================
	trigger run_0
	{
		accum 1 bitset 2
		followspline 0 spln0 80 wait length -64 
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_1
	{
		accum 1 bitset 2
		followspline 0 spln1 80 wait length -64 
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_2
	{
		accum 1 bitset 2
		followspline 0 spln2 80 wait length -64 
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_3
	{
		accum 1 bitset 2
		followspline 0 spln3 80 wait length -64 
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_4
	{
		accum 1 bitset 2
		followspline 0 spln4 80 wait length -64	
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_5
	{
		accum 1 bitset 2
		followspline 0 spln5 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_6
	{
		accum 1 bitset 2
		followspline 0 spln6 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_7
	{
		accum 1 bitset 2
		followspline 0 spln7 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_8
	{
		accum 1 bitset 2
		followspline 0 spln8 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_9
	{
		accum 1 bitset 2
		followspline 0 spln9 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_10
	{
		accum 1 bitset 2
		followspline 0 spln10 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_11
	{
		accum 1 bitset 2
		followspline 0 spln11 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_12
	{
		accum 1 bitset 2
		followspline 0 spln12 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_13
	{
		accum 1 bitset 2
		followspline 0 spln13 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_14
	{
		accum 1 bitset 2
		followspline 0 spln14 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_15
	{
		accum 1 bitset 2
		followspline 0 spln15 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_16
	{
		accum 1 bitset 2
		followspline 0 spln16 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_17
	{
		accum 1 bitset 2
		followspline 0 spln17 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_18
	{
		accum 1 bitset 2
		followspline 0 spln18 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_19
	{
		accum 1 bitset 2
		followspline 0 spln19 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_20
	{
		accum 1 bitset 2
		followspline 0 spln20 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_21
	{
		accum 1 bitset 2
		followspline 0 spln21 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_22
	{
		accum 1 bitset 2
		followspline 0 spln22 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_23
	{
		accum 1 bitset 2
		followspline 0 spln23 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_24
	{
		accum 1 bitset 2
		followspline 0 spln24 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_25
	{
		accum 1 bitset 2
		followspline 0 spln25 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_26
	{
		accum 1 bitset 2
		followspline 0 spln26 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_27
	{
		accum 1 bitset 2
		followspline 0 spln27 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_28
	{
		accum 1 bitset 2
		followspline 0 spln28 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_29
	{
		accum 1 bitset 2
		followspline 0 spln29 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_30
	{
		accum 1 bitset 2
		followspline 0 spln30 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_31
	{
		accum 1 bitset 2
		followspline 0 spln31 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_32
	{
		accum 1 bitset 2
		followspline 0 spln32 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_33
	{
		accum 1 bitset 2
		followspline 0 spln33 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_34
	{
		accum 1 bitset 2
		followspline 0 spln34 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_35
	{
		accum 1 bitset 2
		followspline 0 spln35 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_36
	{
		accum 1 bitset 2
		followspline 0 spln36 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	//-----------------------------------------------------------------------
	// The bridge
	//-----------------------------------------------------------------------	

	trigger run_37
	{
		accum 1 bitset 2
		followspline 0 spln37 80 wait length -64
		followspline 0 spln38 80 wait length -64
		followspline 0 spln39 80 wait length -64
		followspline 0 spln40 80 wait length -64
		followspline 0 spln41 80 wait length -64
		followspline 0 spln42 80 wait length -64
		followspline 0 spln43 80 wait length -64
		followspline 0 spln44 80 wait length -64
		followspline 0 spln45 80 wait length -64
		followspline 0 spln46 80 wait length -64
		accum 1 bitreset 2

		//setup sounds
		trigger thebridge tank_passed	// Remove all bridge ref VO

		trigger self run_continue
	}

	trigger run_38
	{
		accum 1 bitset 2
		followspline 0 spln47 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_39
	{
		accum 1 bitset 2
		followspline 0 spln48 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_40
	{
		accum 1 bitset 2
		followspline 0 spln49 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_41
	{
		accum 1 bitset 2
		followspline 0 spln50 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_42
	{
		wm_teamvoiceannounce 0 "axis_tank_in_tunnels"
		accum 1 bitset 2
		followspline 0 spln51 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_43
	{
		accum 1 bitset 2
		followspline 0 spln52 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_44
	{
		wm_teamvoiceannounce 0 "axis_stop_the_tank_b"
		accum 1 bitset 2
		followspline 0 spln53 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_45
	{
		accum 1 bitset 2
		followspline 0 spln54 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_46
	{
		accum 1 bitset 2
		followspline 0 spln55 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_47
	{
		accum 1 bitset 2
		followspline 0 spln56 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_48
	{
		accum 1 bitset 2
		followspline 0 spln57 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_49
	{
		accum 1 bitset 2
		followspline 0 spln58 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_50
	{
		accum 1 bitset 2
		followspline 0 spln59 80 wait length -64
		accum 1 bitreset 2
		
		trigger self run_continue
	}

	trigger run_51
	{
		accum 1 bitset 2
		followspline 0 spln60 80 wait length -64 
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_52
	{
		accum 1 bitset 2
		followspline 0 spln61 80 wait length -64 
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_53
	{
		accum 1 bitset 2
		followspline 0 spln62 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_54
	{
		accum 1 bitset 2
		followspline 0 spln63 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_55
	{
		accum 1 bitset 2
		followspline 0 spln64 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_56
	{
		accum 1 bitset 2
		followspline 0 spln65 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_57
	{
		accum 1 bitset 2
		followspline 0 spln66 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_58
	{
		accum 1 bitset 2
		followspline 0 spln67 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_59
	{
		accum 1 bitset 2
		followspline 0 spln68 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_60
	{
		accum 1 bitset 2
		followspline 0 spln69 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_61
	{
		accum 1 bitset 2
		followspline 0 spln70 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	trigger run_62
	{
		accum 1 bitset 2
		followspline 0 spln71 80 wait length -64
		accum 1 bitreset 2

		trigger self run_continue
	}

	
	trigger run_63
	{
		accum 1 bitset 2
		followspline 0 spln72 80 wait length -64
		accum 1 bitreset 2

		trigger self		script_lockout

		
		trigger self tracks_stop
		trigger self sound_death
		trigger tank_sound stop
		
		  
		accum 3 inc 1
		startanimation 0 	1 	15 nolerp norandom
		wait 900

		trigger self script_lockout_stop
		trigger self run_incpos
		
		setstate tank_trigger invisible
		setstate tank invisible
		setstate tank_build invisible
		

		trigger crane_controller startcrane
		trigger game_manager tank_at_depotyard

	 
	}

	
	

// ===========================================================================================
// ===========================================================================================
// stuck checking
// digibob: since we cant return variables, just use bit 3 of accum 1 as a register... mmmm assembly...
	trigger stuck_check
	{
		accum 1 bitreset 3

		trigger self stuck_check_bridge_built
		trigger self stuck_check_bridge_dyna
		trigger self stuck_check_doors_dyna
		trigger self stuck_check_scriptlockout
		trigger self stuck_check_finished
	}

	trigger stuck_check_finished
	{
		accum 3 abort_if_less_than 64

		accum 1 bitset 3
	}

	trigger stuck_check_scriptlockout
	{
		accum 5 abort_if_equal 0

		accum 1 bitset 3
	}

	trigger stuck_check_bridge_built
	{
		accum 3 abort_if_not_equal 37

		accum 1 abort_if_bitset 0

		accum 1 bitset 3
	}

	trigger stuck_check_bridge_dyna
	{
		accum 3 abort_if_not_equal 37

		accum 0 set_to_dynamitecount bridgetarget
		accum 0 abort_if_equal 0

		accum 1 bitset 3
	}

	trigger stuck_check_doors_dyna
	{
		accum 3 abort_if_not_equal 38
	
		accum 2 abort_if_not_equal 0
	
		accum 1 bitset 3
	}

	
// ===========================================================================================
// ===========================================================================================
// stop check

	trigger stopcheck_setup
	{
		accum 1 bitset 6			// stop if we're stuck/no-one's pushing :)

		accum 1 abort_if_bitset 8		// no one in the trigger, abort

		trigger self stuck_check		// call the stop check function
		accum 1 abort_if_bitset 3		// we're stuck so break out

		accum 1 bitreset 6			// we're free to move
	}

	trigger stopcheck
	{
		trigger self stopcheck_setup
		accum 1 abort_if_not_bitset 6

		trigger self script_lockout

		// Any just stopped moving stuff goes here
		trigger tank_sound 	stop
		trigger self 		tracks_stop
		startanimation 40 	9 	15 nolerp norandom
		wait 666
		startanimation 0 	1 	15 nolerp norandom
		wait 900

		trigger self script_lockout_stop
		resetscript
	}

// ===========================================================================================
// ===========================================================================================
// script lockouts

	trigger script_lockout
	{
		accum 5 inc 1
	}

	trigger script_lockout_stop
	{
		accum 5 inc -1
	}

// ===========================================================================================
// ===========================================================================================
// enable/disable

	trigger tank_enable
	{
		trigger self stuck_check
		accum 1 abort_if_bitset 3 	// stuck check

		accum 4 set 0				// reset stop counter
		accum 1 bitreset 8			// reset stop check

		accum 1 abort_if_bitset 2 	// already following spline
		accum 5 abort_if_not_equal 0	// are we not in a script lockout?

		accum 1 abort_if_bitset 7 	// death check

		// Any just started moving stuff goes here

		trigger self script_lockout

		trigger tank_sound start

		startanimation 50 9 15 nolerp norandom
		wait 666
		startanimation 0 39 15 nolerp norandom
		wait 500
		trigger self tracks_forward

		trigger self script_lockout_stop

		trigger self move
	}

	trigger tank_disable
	{
		accum 4 inc 1				// up the stop counter
		accum 4 abort_if_less_than 4

		accum 1 bitset 8			// set stop check

		trigger self deathcheck
	}

// ===========================================================================================
// ===========================================================================================
// death / rebirth

	rebirth
	{
		accum 1 bitreset 9 // we're visibly alive
		accum 1 bitreset 7 // we're alive again

		trigger self script_lockout

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "axis_hq_tank_repaired_allies"

		wm_teamvoiceannounce 1 "allies_hq_tank_repaired"
		// *---------------------------------------------------------------------------------*
		wm_announce "The Tank has been repaired"

		changemodel models/mapobjects/v1/lorraine.md3

		setstate tank_smoke1 invisible
		setstate tank_smoke2 invisible

		trigger tank_sound rebirth
		wait 500

		trigger self script_lockout_stop
	}

	death
	{
		accum 1 bitset 7
	}

	trigger deathcheck
	{
		accum 1 abort_if_not_bitset 7	// are we dead?
		accum 1 abort_if_bitset 9	// are we not already visibly dead?
		accum 1 abort_if_bitset 2	// are we not following a spline?
		accum 5 abort_if_not_equal 0	// are we not in a script lockout?

		accum 1 bitset 9		// we're now visibly dead

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "axis_hq_tank_damaged"

		wm_teamvoiceannounce 1 "allies_hq_tank_damaged_axis"
		// *---------------------------------------------------------------------------------*

		wm_announce "The Tank has been damaged"

		changemodel models/mapobjects/v1/lorraine_broken.md3

		accum 6 random 2
		accum 6 trigger_if_equal 0 tank_smoke1 burnbabyburn1
		accum 6 trigger_if_equal 1 tank_smoke2 burnbabyburn2

		kill tank_construct

		trigger self sound_death
		trigger self tracks_stop

		trigger self script_lockout

		trigger self tracks_stop
		startanimation 40 9 15 nolerp norandom
		wait 666
		startanimation 0 1 15 nolerp norandom

		trigger self script_lockout_stop

		resetscript
	}

	trigger setBridge
	{
		wm_objective_status 1 1 1
		wm_objective_status 1 0 2

		accum 1 bitset 0
	}

	trigger clearBridge
	{
		wm_objective_status 1 1 0
		wm_objective_status 1 0 0

		accum 1 bitreset 0
	}

	trigger doors_destroyed
	{
		accum 2 set 1
	}
}

tank_disabler
{
	trigger run
	{
		trigger tank tank_disable
	}
}

tank_enabler
{
	trigger run
	{
		trigger tank tank_enable
	}
}

tank_trigger
{
     spawn
     {
          wait 100

        
	attachtotag tank tag_followme
	
	
     }
}

tank_build
{
     spawn
     {
          wait 100

         
	attachtotag tank tag_followme
	
     }
}

tank_construct
{
	spawn
	{
		wait 400

		constructible_class 2
		constructible_health 1200
		constructible_constructxpbonus 12
		constructible_destructxpbonus 12
	}

	built final
	{
		alertentity tank
	}

	
}

tank_smoke1
{
	spawn
	{
		wait 50
		attachtotag tank tag_smokerea
		setstate tank_smoke1 invisible
	}
	
	trigger burnbabyburn1
	{
		setstate tank_smoke1 default
	}
}

tank_smoke2
{
	spawn
	{
		wait 50
		attachtotag tank tag_smoket2
		setstate tank_smoke2 invisible
	}

	trigger burnbabyburn2
	{
		setstate tank_smoke2 default
	}
}



// ================================================
// ====== MG GUN NEAR THE MAIN ENTRANCE ===========
// ================================================
browning_clip_2
{
	spawn
	{
		wait 200
		trigger browning_clip_2 setup

		constructible_class 2
	}

	trigger setup
	{
		setstate browning_2 invisible
		setstate browning_sbags_2 invisible

		setstate browning_materials_2 default
		setstate browning_materials_clip_2 default
		setstate browning_flag_1 default
	}

	buildstart final
	{
		setstate browning_2 underconstruction
		setstate browning_sbags_2 underconstruction

		setstate browning_materials_2 default
		setstate browning_materials_clip_2 default
		setstate browning_flag_2 default
	}

	built final
	{
		setstate browning_2 default
		setstate browning_sbags_2 default

		setstate browning_materials_2 invisible
		setstate browning_materials_clip_2 invisible
		setstate browning_flag_2 invisible

		wm_announce "The Allied MG Nest has been constructed."
	}

	decayed final
	{
		setstate browning_2 invisible
		setstate browning_sbags_2 invisible

		setstate browning_materials_2 default
		setstate browning_materials_clip_2 default
		setstate browning_flag_2 default
	}

	death
	{
		setstate browning_2 invisible
		setstate browning_sbags_2 invisible
		repairmg42 browning_2
		setstate browning_materials_2 default
		setstate browning_materials_clip_2 default
		setstate browning_flag_2 default

		wm_announce "The Allied MG Nest has been destroyed."
	}
}

// ================================================
// ====== AXIS MG GUN NEAR THE First RADAR ========
// ================================================

axisconstruct1
{
	spawn
	{
		wait 50
		trigger self setup
		constructible_class 2			// Dyno+Satchel
	}

	trigger setup
	{
		setstate axisconstruct1_materials default	// Crate Models
		setstate axisconstruct1_clip default	// Clip brushes
		setstate axisconstruct1_flag default
		setstate axis_constr_sandb1 invisible // sandbags
		setstate axisconstruct1_mg42 invisible	// MG42 entity
		repairmg42 axisconstruct1_mg42
	}

	built final
	{
		setstate axisconstruct1_materials invisible	// Crate Models
		setstate axisconstruct1_clip invisible	// Clip brushes
		setstate axisconstruct1_flag invisible
		setstate axis_constr_sandb1 default
		setstate axisconstruct1_mg42 default	// MG42 entity

		wm_announce "Axis Team have built the MG42 nest near the First Radar!!"
	}

	decayed final
	{
		trigger self setup
	}

	death
	{
		trigger self setup
		wm_announce "Allies have destroyed the MG42 nest near the First Radar!!" 
	}
}

// ================================================
// ====== AXIS MG GUN At The Bunker ========
// ================================================

axisconstruct2
{
	spawn
	{
		wait 50
		trigger self setup
		constructible_class 2			// Dyno+Satchel
	}

	trigger setup
	{
		setstate axisconstruct2_materials default	// Crate Models
		setstate axisconstruct2_clip default	// Clip brushes
		setstate axisconstruct2_flag default
		
		setstate axisconstruct2_mg42 invisible	// MG42 entity
		repairmg42 axisconstruct2_mg42
	}

	built final
	{
		setstate axisconstruct2_materials invisible	// Crate Models
		setstate axisconstruct2_clip invisible	// Clip brushes
		setstate axisconstruct2_flag invisible
		
		setstate axisconstruct2_mg42 default	// MG42 entity

		wm_announce "Axis Team have built the MG42 at the bunker!!"
	}

	decayed final
	{
		trigger self setup
	}

	death
	{
		trigger self setup
		wm_announce "Allies have destroyed the MG42 nest at the bunker!!" 
	}
}


// ================================================
// ====== MAIN ENTRANCE AXIS ROCKET BASE ==========
// ================================================
maindoor1 
{
	spawn
	{
		accum 2 set 0
		wait 50
		constructible_class	3
		setstate maindoor1 default
	}

	death
	{
		trigger tank doors_destroyed
		trigger game_manager maindoor1_destroyed
		togglespeaker maindooralarm
	}
	
	defused
	{ 
      		
		
		togglespeaker maindooralarm
   	}
}

maindoor1_trig
{
	spawn
	{
	}

	 dynamited 
   	{ 
      		
		togglespeaker maindooralarm
   	}
		
	

}

// ============================================================================
// ======The Bridge============================================================
// ============================================================================
thebridge
{
	spawn
	{
		accum 7 set 0	// Bridge stage construction and tank status
		wait 200

		constructible_class 3
		constructible_constructxpbonus 15
		constructible_destructxpbonus 20
		setstate bridgematerials_stage1 default
		setstate bridgematerials_stage2 default

		accum 7 bitset 1	// Tank NOT over bridge yet
	}

	//-----------------------------------------------------------------------
	// Stage 1 is BUILT
	//-----------------------------------------------------------------------
	built stage1
	{
		setstate bridgematerials_stage1 invisible	// Remove stage 1 construction items
		trigger game_manager objective1

		accum 7 abort_if_not_bitset 1	// Tank over bridge?

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "fueldump_axis_bridge_destroy"

		wm_addteamvoiceannounce 1 "fueldump_allies_bridge_reinforce"

		wm_teamvoiceannounce 0 "fueldump_axis_bridge_destroy"

		wm_teamvoiceannounce 1 "fueldump_allies_bridge_reinforce"

		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_stop"

		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_construct"
		// *---------------------------------------------------------------------------------*
	}

	//-----------------------------------------------------------------------
	// Stage 1 is DESTROYED
	//-----------------------------------------------------------------------
	death
	{
		setstate bridgematerials_stage1 default		// Restore stage 1 construction items
		togglespeaker bridge_expl			// Explosion

		trigger tank clearBridge

		// Some kind of UI pop-up to alert players
		wm_announce	"Axis team has destroyed the Bridge!"

		accum 7 abort_if_not_bitset 1	// Tank over bridge?

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "fueldump_axis_bridge_stop"

		wm_addteamvoiceannounce 1 "fueldump_allies_bridge_construct"

		wm_teamvoiceannounce 0 "fueldump_axis_bridge_destroyed"

		wm_teamvoiceannounce 1 "fueldump_allies_bridge_construct"

		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_destroy"

		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_reinforce"
		// *---------------------------------------------------------------------------------*
	}

	//-----------------------------------------------------------------------
	// Stage 2 is BUILT
	//-----------------------------------------------------------------------
	built final
	{
		setstate bridgematerials_stage2 invisible
		trigger tank setBridge

		// Some kind of UI pop-up to alert players
		wm_announce	"Allied team has reinforced the Bridge!"

		accum 7 abort_if_not_bitset 1	// Tank over bridge?

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "fueldump_axis_bridge_destroy"

		wm_addteamvoiceannounce 1 "fueldump_allies_tank_bridge"

		wm_teamvoiceannounce 0 "fueldump_axis_bridge_reinforced"
		wm_teamvoiceannounce 0 "radar_axis_entrance1_stop"

		wm_teamvoiceannounce 1 "fueldump_allies_bridge_reinforced"
		wm_teamvoiceannounce 1 "fueldump_allies_tank_bridge"
		wm_teamvoiceannounce 1 "radar_allies_entrance1_destroy"

		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_stop"

		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_reinforce"
		// *---------------------------------------------------------------------------------*

		wm_set_main_objective		1	0	// Completed an objective
	}

	//-----------------------------------------------------------------------
	// Stage 2 is DESTROYED, go back to stage 1
	//-----------------------------------------------------------------------
	destroyed final
	{
		setstate bridgematerials_stage2 default
		togglespeaker bridge_expl

		trigger tank clearBridge

		// Some kind of UI pop-up to alert players
		wm_announce	"Axis team has damaged the Bridge!"

		accum 7 abort_if_not_bitset 1	// Tank over bridge?

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "fueldump_axis_bridge_destroy"
		wm_addteamvoiceannounce 1 "fueldump_allies_bridge_reinforce"

		wm_teamvoiceannounce 0 "fueldump_axis_bridge_damaged"

		wm_teamvoiceannounce 1 "fueldump_allies_bridge_damaged"

		wm_removeteamvoiceannounce 1 "fueldump_allies_tank_bridge"
		// *---------------------------------------------------------------------------------*
	}

	//-----------------------------------------------------------------------
	// Tank has made it over the bridge and on route to the cave doors
	// remove all VO reference to the bridge construct/destruct
	//-----------------------------------------------------------------------
	trigger tank_passed
	{
		accum 7 bitreset 1	// Tank over bridge, no more announcements

		// *----------------------------------- vo ------------------------------------------*
		//wm_addteamvoiceannounce 0 "fueldump_axis_tunnel_stop"
		//wm_addteamvoiceannounce 1 "fueldump_allies_tank_depot"

		//wm_teamvoiceannounce 0 "fueldump_axis_tunnel_stop"

		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_destroy"
		wm_removeteamvoiceannounce 0 "fueldump_axis_bridge_stop"

		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_construct"
		wm_removeteamvoiceannounce 1 "fueldump_allies_bridge_reinforce"
		wm_removeteamvoiceannounce 1 "fueldump_allies_tank_bridge"
		// *---------------------------------------------------------------------------------*
	}
}

// ================================================
// ============ NEUTRAL COMMAND POST ==============
// ================================================

allied_compost_built
{
	spawn
	{
		wait 400
		trigger allied_compost_built setup

		constructible_class 2
	}

	trigger setup
	{
		setchargetimefactor 1 soldier 1
		setchargetimefactor 1 lieutenant 1
		setchargetimefactor 1 medic 1
		setchargetimefactor 1 engineer 1
		setchargetimefactor 1 covertops 1
		sethqstatus 1 0
	}

	buildstart final
	{
		setstate allied_compost_built_model underconstruction
		setstate neutral_compost_closed_clip invisible
		setstate neutral_compost_closed_model invisible
	}

	built final
	{
		setstate allied_compost_built_model default
		setstate neutral_compost_closed_clip invisible
		setstate neutral_compost_closed_model invisible

		trigger allied_compost_built_model enable_allied_features

		enablespeaker allies_radio
	}

	decayed final
	{
		setstate allied_compost_built_model invisible
		setstate neutral_compost_closed_clip default
		setstate neutral_compost_closed_model default
	}

	death
	{
		setstate allied_compost_built_model invisible
		setstate neutral_compost_closed_clip default
		setstate neutral_compost_closed_model default

		trigger allied_compost_built_model disable_allied_features

		disablespeaker allies_radio
	}
}

allied_compost_built_model
{
	spawn
	{
		wait 400
		setstate allied_compost_built_model invisible
	}

	trigger enable_allied_features
	{
		setchargetimefactor 1 soldier 0.75
		setchargetimefactor 1 lieutenant 0.75
		setchargetimefactor 1 medic 0.75
		setchargetimefactor 1 engineer 0.75
		setchargetimefactor 1 covertops 0.75
		sethqstatus 1 1

		wm_announce	"Allied Command Post constructed. Charge speed increased!"

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "axis_hq_compost_constructed_allies"

		wm_teamvoiceannounce 1 "allies_hq_compost_constructed"

		wm_removeteamvoiceannounce 1 "allies_hq_compost_construct"
		// *---------------------------------------------------------------------------------*

		wm_objective_status 6 0 2
		wm_objective_status 6 1 1
	}

	trigger disable_allied_features
	{
		setchargetimefactor 1 soldier 1
		setchargetimefactor 1 lieutenant 1
		setchargetimefactor 1 medic 1
		setchargetimefactor 1 engineer 1
		setchargetimefactor 1 covertops 1
		sethqstatus 1 0

		wm_announce	"Axis team has destroyed the Allied Command Post!"

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "axis_hq_compost_construct"

		wm_addteamvoiceannounce 1 "allies_hq_compost_construct"

		wm_teamvoiceannounce 0 "axis_hq_compost_construct"

		wm_teamvoiceannounce 1 "allies_hq_compost_damaged"
		// *---------------------------------------------------------------------------------*

		wm_objective_status 6 0 0
		wm_objective_status 6 1 0
	}
}

axis_compost_built
{
	spawn
	{
		wait 400
		trigger axis_compost_built setup

		constructible_class 2
	}

	trigger setup
	{
		setchargetimefactor 0 soldier 1
		setchargetimefactor 0 lieutenant 1
		setchargetimefactor 0 medic 1
		setchargetimefactor 0 engineer 1
		setchargetimefactor 0 covertops 1
		sethqstatus 0 0
	}

	buildstart final
	{
		setstate axis_compost_built_model underconstruction
		setstate neutral_compost_closed_clip invisible
		setstate neutral_compost_closed_model invisible
	}

	built final
	{
		setstate axis_compost_built_model default
		setstate neutral_compost_closed_clip invisible
		setstate neutral_compost_closed_model invisible

		trigger axis_compost_built_model enable_axis_features

		enablespeaker axis_radio
	}

	decayed final
	{
		setstate axis_compost_built_model invisible
		setstate neutral_compost_closed_clip default
		setstate neutral_compost_closed_model default
	}

	death
	{
		setstate axis_compost_built_model invisible
		setstate neutral_compost_closed_clip default
		setstate neutral_compost_closed_model default

		trigger axis_compost_built_model disable_axis_features

		disablespeaker axis_radio
	}
}

axis_compost_built_model
{
	spawn
	{
		wait 400
		setstate axis_compost_built_model invisible
	}

	trigger enable_axis_features
	{
		setchargetimefactor 0 soldier 0.75
		setchargetimefactor 0 lieutenant 0.75
		setchargetimefactor 0 medic 0.75
		setchargetimefactor 0 engineer 0.75
		setchargetimefactor 0 covertops 0.75
		sethqstatus 0 1

		wm_announce	"Axis Command Post constructed. Charge speed increased!"

		// *----------------------------------- vo ------------------------------------------*
		wm_teamvoiceannounce 0 "axis_hq_compost_constructed"

		wm_teamvoiceannounce 1 "allies_hq_compost_constructed_axis"

		wm_removeteamvoiceannounce 0 "axis_hq_compost_construct"
		// *---------------------------------------------------------------------------------*

		wm_objective_status 7 0 1
		wm_objective_status 7 1 2
	}

	trigger disable_axis_features
	{
		setchargetimefactor 0 soldier 1
		setchargetimefactor 0 lieutenant 1
		setchargetimefactor 0 medic 1
		setchargetimefactor 0 engineer 1
		setchargetimefactor 0 covertops 1
		sethqstatus 0 0

		wm_announce	"Allied team has destroyed the Axis Command Post!"

		// *----------------------------------- vo ------------------------------------------*
		wm_addteamvoiceannounce 0 "axis_hq_compost_construct"

		wm_addteamvoiceannounce 1 "allies_hq_compost_construct"

		wm_teamvoiceannounce 0 "axis_hq_compost_damaged"

		wm_teamvoiceannounce 1 "allies_hq_compost_construct"
		// *---------------------------------------------------------------------------------*

		wm_objective_status 7 0 0
		wm_objective_status 7 1 0
	}
}

// ================================================
// ===========Big Door near Rocketfuel ============
// ================================================

rocdoor_trigger1			
{
	spawn
	{
		accum 5 set 1			// Initial state is down
		wait 500			// Wait for everything to settle
		trigger rocdoor_trigger1 main	// Move switch into correct position
	}
	trigger main
	{
		trigger rocdoor_trigger1 up
		trigger rocdoor_trigger1 down
		wait 2000			// Let previous routines catch up
		accum 5 abort_if_not_equal 2	// End of up routine detected
		accum 5 set 0			// Finish off up routine
		
	}	
	trigger up
	{
			accum 5 abort_if_not_equal 1	// Ready to run up routine == 1
			trigger rocdoor_lever1 up
			trigger rocdoor_lever2 up
			accum 5 set 2			// Needs to be set after trigger down has run
	}
	trigger down
	{
			accum 5 abort_if_not_equal 0	// Ready to run down routine == 0
			trigger rocdoor_lever1 down
			trigger rocdoor_lever2 down
			accum 5 set 1			// Setup accum for up routine
	}
}

// Code for levers, sound effects and path_corners
rocdoor_lever1
{
	spawn
	{
	}
	trigger down
	{
		gotomarker rocdoor_lever1_downpos 16
		playsound sound/movers/switches/butn2.wav
		trigger rocdoor_left open
		trigger rocdoor_right open
	}
	trigger up
	{
		gotomarker rocdoor_lever1_uppos 16
		playsound sound/movers/switches/switch.wav
		trigger rocdoor_left close
		trigger rocdoor_right close
	}
}

rocdoor_lever2
{
	spawn
	{
	}

	trigger down
	{
		gotomarker rocdoor_lever2_downpos 16
		playsound sound/movers/switches/butn2.wav
	}

	trigger up
	{
		gotomarker rocdoor_lever2_uppos 16
		playsound sound/movers/switches/switch.wav
	}
}

// Code for doors, sound effects and path_corners
rocdoor_left
{
	spawn
	{
	}

	trigger open
	{
		wait 500
		playsound sound/movers/misc/big_gate1.wav volume 127
		wait 400
		enablespeaker frontdoor_sound
		gotomarker rocdoor_leftpos2 20 wait
		disablespeaker frontdoor_sound
		playsound sound/movers/misc/big_gate3.wav volume 127
		
	}

	trigger close
	{
		wait 500
		playsound sound/movers/misc/big_gate1.wav volume 127
		wait 400
		enablespeaker frontdoor_sound
		gotomarker rocdoor_leftpos1 20 wait
		disablespeaker frontdoor_sound
		playsound sound/movers/misc/big_gate3.wav volume 127
	}
}

rocdoor_right
{
	spawn
	{
	}

	trigger open
	{
		wait 900
		gotomarker rocdoor_rightpos2 20 wait
		playsound sound/movers/misc/big_gate3.wav volume 127
	}

	trigger close
	{
		wait 500
		playsound sound/movers/misc/big_gate1.wav volume 127
		wait 400
		gotomarker rocdoor_rightpos1 20 wait
		playsound sound/movers/misc/big_gate1.wav volume 127
	}
}

//crane and depoyard

tank_static
{
	
	spawn
	{
		wait 50
		faceangles 0 90 0 50
	}
	
	trigger rockandroll
	{
		setstate tank_static default
	}
}


crane_controller
{
	
	spawn
	{
		
	}
	
	trigger startcrane
	{
		trigger tank_static rockandroll
		trigger thev1rocket setup
		
		wait 5000
		
		trigger crane shift_left
		trigger crane_hook shift_left

	
	}
}


crane_sound
{
	trigger crane_start
	{
		trigger crane crane_start
		wait 250
		trigger crane crane_loop
	}

	trigger crane_stop
	{
		trigger crane crane_stop
	}

	trigger hook_start
	{
		trigger crane hook_start
		wait 700
		trigger crane hook_loop
	}

	trigger hook_stop
	{
		trigger crane hook_stop
	}
}

crane
{
	trigger shift_left
	{
		trigger crane_sound crane_start

		gotomarker path01 50 wait

		trigger crane_sound crane_stop
	}

	trigger shift_right
	{
		trigger crane_sound crane_start

		gotomarker path02 50 wait

		trigger crane_sound crane_stop
	}

	trigger crane_start
	{
		stopsound
		playsound sound/movers/motors/motor_start_02.wav volume 96
	}

	trigger crane_loop
	{
		playsound sound/movers/motors/motor_loop_02.wav looping
	}

	trigger crane_stop
	{
		stopsound
		playsound sound/movers/motors/motor_end_02.wav volume 96
	}

	trigger hook_start
	{
		stopsound
		playsound sound/movers/motors/motor_start_01.wav volume 96
	}

	trigger hook_loop
	{
		playsound sound/movers/motors/motor_loop_01.wav looping
	}

	trigger hook_stop
	{
		stopsound
		playsound sound/movers/motors/motor_end_01.wav volume 96
	}
}

crane_hook
{
	
	trigger shift_left
	{
		gotomarker path05 50 wait

		trigger crane_hook golow
	}

	trigger golow
	{
		trigger crane_sound hook_start
		gotomarker path04 50 wait

		trigger thev1rocket raise_large
		trigger crane_hook raise_large
	}

	trigger raise_large
	{
		trigger crane_sound hook_start

		gotomarker path03 50 wait

		trigger crane shift_right
		trigger thev1rocket shift_right
		trigger crane_hook shift_right
	}

	trigger shift_right
	{
		trigger crane_sound hook_stop

		gotomarker path06 50 wait

		trigger thev1rocket lower_large
		trigger crane_hook lower_large
	}

	trigger lower_large
	{
		trigger crane_sound hook_start

		gotomarker path07 50 wait

		trigger crane_hook raise_up
	}

	trigger raise_up
	{
		trigger crane_sound hook_start
		gotomarker path06 50 wait
		trigger crane_sound hook_stop

		trigger train ammo_loaded
		trigger thev1rocket ammo_loaded
	}
}

rocket_smoke
{
	spawn
	{
		wait 300
		attachtotag thev1rocket tag_smoke
		setstate rocket_smoke invisible
	}
}

thev1rocket
{
	
	spawn
	{
		
		wait 50
		
		faceangles 0 90 0 50
	}

	trigger setup
	{	
		setstate thev1rocket default
	}

	trigger raise_large
	{
		gotomarker rocketpath01 50 wait
	}

	trigger shift_right
	{
		gotomarker rocketpath02 50 wait
	}

	trigger lower_large
	{
		gotomarker rocketpath03 50 wait
		wait 3000
	}

	trigger ammo_loaded
	{
		wait 2000
		followspline 0 splnt1 100 wait length -64
		followspline 0 splnt2 100 wait length -64
		followspline 0 splnt3 100 wait length -64
		followspline 0 splnt4 100 wait length -64
		followspline 0 splnt5 100 wait length -64
		followspline 0 splnt6 100 wait length -64
		followspline 0 splnt7 100 wait length -64
		followspline 0 splnt8 100 wait length -64
		followspline 0 splnt9 100 wait length -64
		followspline 0 splnt10 100 wait length -64
		followspline 0 splnt11 100 wait length -64
		
		
		setstate rocket_endpoint default
		setstate v1rocket_toi default		
		setstate v1rocket_cm_marker default
		
		
	}

	trigger launch
	{
		alertentity rocket_smoke
		setstate rocket_smoke default
		trigger rocketrumble startrumbling
				

		wait 2000
		gotomarker v1path2 200 wait
		gotomarker v1path3 200
	}

	
}

train_sound
{
	trigger train_start
	{
		trigger train train_start
	}

	trigger train_loop
	{
		trigger train train_loop
	}

	trigger train_end
	{
		trigger train train_stop
	}
}

train
{
	
	spawn
	{
		faceangles 0 90 0 50	
	}

	trigger train_start
	{	
		stopsound
		playsound sound/v1rocket/ff_train_start.wav volume 96
	}

	trigger train_loop
	{
		playsound sound/v1rocket/ff_train_loop.wav looping
	}

	trigger train_stop
	{
		stopsound
		playsound sound/v1rocket/ff_train_stop.wav volume 96
	}	

	trigger ammo_loaded
	{
		wait 2000
		trigger train train_forward
		trigger train_sound train_start
		trigger train_sound train_loop
		followspline 0 splnt1 100 wait length -64
		followspline 0 splnt2 100 wait length -64
		followspline 0 splnt3 100 wait length -64
		followspline 0 splnt4 100 wait length -64
		followspline 0 splnt5 100 wait length -64
		followspline 0 splnt6 100 wait length -64
		followspline 0 splnt7 100 wait length -64
		followspline 0 splnt8 100 wait length -64
		followspline 0 splnt9 100 wait length -64
		followspline 0 splnt10 100 wait length -64
		followspline 0 splnt11 100 wait length -64
		trigger train tracks_halt
		trigger train_sound train_end
		
	}
	
	trigger train_forward
	{
		remapshader textures/v1rocket/ff_trainwheels	textures/v1rocket/ff_trainwheels_move 
		remapshaderflush
	}

	trigger tracks_halt
	{
		remapshader textures/v1rocket/ff_trainwheels 	textures/v1rocket/ff_trainwheels
		remapshaderflush
	}

	
	
}


doorsmoke1
{
	spawn
	{
		wait 50
		attachtotag debris1 tag_smoked1
		
	}
}

doorsmoke2
{
	spawn
	{
		wait 50
		attachtotag debris2 tag_smoked2
		
	}
}

doorsmoke3
{
	spawn
	{
		wait 50
		attachtotag debris2 tag_smoked3
		
	}
}

debris1
{
	
	spawn
	{
		faceangles 0 45 90 50	
	}

	trigger flying
	{
		setstate debris1 default
		alertentity doorsmoke1
		setstate doorsmoke1 default
		
		followspline 0 d1path1 450 wait length -64 roll 20 25
		followspline 0 d1path2 400 wait length -64 roll 45 45 
		followspline 0 d1path3 350 wait length -64 roll 90 65
		followspline 0 d1path4 300 wait length -64 roll 155 45
		followspline 0 d1path5 200 wait length -64 roll 200 25	
		wait 9000
		setstate doorsmoke1 invisible
		
	}

	
	
}

debris2
{
	
	spawn
	{
		faceangles 0 225 -90 50	
	}

	trigger flying
	{
		setstate debris2 default 
		alertentity doorsmoke2
		//alertentity doorsmoke3
		setstate doorsmoke2 default
		//setstate doorsmoke3 default
		
		
		followspline 0 d2path1 450 wait length -64
		followspline 0 d2path2 400 wait length -64 roll 45 45
		alertentity doorsmoke3
		setstate doorsmoke3 default
		
		followspline 0 d2path3 350 wait length -64 roll 90 30
		followspline 0 d2path4 300 wait length -64 roll 120 45
		wait 6000
		setstate doorsmoke2 invisible
		setstate doorsmoke3 invisible
	}

	
	
}

truckdummy
{
	
	spawn
	{
		faceangles 0 270 0 50	
	}
}

tire_dummy
{
	
	spawn
	{
		faceangles 0 0 90 50	
	}
}

rocket_dummy
{
	
	spawn
	{
		faceangles 15 270 0 50	
	}
}

rocketrumble
{
	
	spawn
	{
	}

	trigger startrumbling
	{
	  alertentity rocketrumble
	}
}

